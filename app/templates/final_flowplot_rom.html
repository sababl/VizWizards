{% extends "base.html" %}

{% block title %}Alluvial Chart{% endblock %}

{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HALE Flow Map</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        p {
            line-height: 3;
        }
    </style>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }
        #flowmap-container {
            display: flex;
            justify-content: flex-end;
            width: 100%; /* Ensures full width so we can push it right */
            padding-right: 15%; /* Moves the plot further to the right */
        }
        #flowmap {
            width: 80%;
            height: 700px;
        }
    </style>
</head>
<body>
    <h2>Healthy Life Expectancy Flow Between Regions</h2>
    <p>
        This flow map visualizes the Healthy Life Expectancy (HALE) differences between global regions.
        Each vertical bar represents a WHO region (Africa, Americas, Asia, Europe, Oceania). The curved lines
        between regions show the HALE gaps between them. Thicker lines indicate larger HALE differences.
        Colors help distinguish whether HALE is increasing (green) or decreasing (red) as we move between regions.
    </p>
    
    <div id="flowmap-container">
        <div id="flowmap"></div>
    </div>

    <script>
        let regions = ["Africa", "Americas", "Asia", "Europe", "Oceania"];
        let hale_values = [55, 73, 68, 79, 75]; // Sample HALE values in years

        let sources = [0, 1, 2, 3, 4]; // Regions as source points
        let targets = [1, 2, 3, 4, 0]; // Regions as destination points
        let values = [18, -5, 11, -4, 20]; // HALE differences in years

        // Assign colors based on HALE increase (green) or decrease (red)
        let link_colors = values.map(val => val > 0 ? "rgba(0, 200, 0, 0.5)" : "rgba(200, 0, 0, 0.5)");

        let data = [{
            type: "sankey",
            orientation: "h",
            node: {
                pad: 25,
                thickness: 30,
                line: { color: "black", width: 0.5 },
                label: regions,
                color: ["red", "orange", "yellow", "green", "blue"],
                x: [0.1, 0.3, 0.5, 0.7, 0.9], // Spacing continents apart on x-axis
                y: [0.5, 0.5, 0.5, 0.5, 0.5] // Aligning them centrally on y-axis
            },
            link: {
                source: sources,
                target: targets,
                value: values.map(Math.abs), // Ensure values are positive for visualization
                color: link_colors,
                label: values.map(v => `${Math.abs(v)} years`) // Add unit to values
            }
        }];

        let layout = {
            title: "Healthy Life Expectancy Flow Between Regions",
            font: { size: 14 },
            width: 1200
        };

        let config = {
            displayModeBar: false // Removes download and other tools
        };

        Plotly.newPlot("flowmap", data, layout, config);
    </script>
</body>
</html>



{% endblock %}