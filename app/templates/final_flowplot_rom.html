{% extends "base.html" %}

{% block title %}HALE Flow Map{% endblock %}

{% block content %}

    <h2 style="text-align: center;">Life Expectancy Flow Map</h2>
    <style>
        p {
            line-height: 1.8;
        }
        .info-box {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
            max-width: 1000px;
            width: 90%;
            text-align: justify;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }
        .chart-container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: auto;
            overflow: hidden;
        }
        #flowmap-container {
            width: 100%;
            max-width: 1100px;
            height: auto;
            max-height: 700px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            padding: 10px;
            box-sizing: border-box;
        }
    </style>

    <div class="info-box">
        <p>
            This flow map visualizes the connections between different regions and their life expectancy rates. 
            The lines represent the flow of data between geographical points, with line thickness indicating the 
            strength of the relationship. This visualization helps identify patterns and disparities in life 
            expectancy across different regions and how they might influence each other.
        </p>
    </div>
    
    <div class="chart-container">
        <div id="flowmap-container">
            <div id="flowmap"></div>
        </div>
    </div>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        let regions = ["Africa", "Americas", "Asia", "Europe", "Oceania"];
        let hale_values = [55, 73, 68, 79, 75]; // Sample HALE values in years

        let sources = [0, 1, 2, 3, 4]; // Regions as source points
        let targets = [1, 2, 3, 4, 0]; // Regions as destination points
        let values = [18, -5, 11, -4, 20]; // HALE differences in years

        // Assign colors based on HALE increase (green) or decrease (red)
        let link_colors = values.map(val => val > 0 ? "rgba(0, 200, 0, 0.5)" : "rgba(200, 0, 0, 0.5)");

        let data = [{
            type: "sankey",
            orientation: "h",
            node: {
                pad: 25,
                thickness: 30,
                line: { color: "black", width: 0.5 },
                label: regions,
                color: ["red", "orange", "yellow", "green", "blue"],
                x: [0.1, 0.3, 0.5, 0.7, 0.9], // Spacing continents apart on x-axis
                y: [0.5, 0.5, 0.5, 0.5, 0.5] // Aligning them centrally on y-axis
            },
            link: {
                source: sources,
                target: targets,
                value: values.map(Math.abs), // Ensure values are positive for visualization
                color: link_colors,
                label: values.map(v => `${Math.abs(v)} years`) // Add unit to values
            }
        }];

        let layout = {
            title: "Healthy Life Expectancy Flow Between Regions",
            font: { size: 14 },
            width: 1100
        };

        let config = {
            displayModeBar: false // Removes download and other tools
        };

        Plotly.newPlot("flowmap", data, layout, config);
    </script>

{% endblock %}
